<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é˜¿å…¬è¬›å¤ App - iPhone 15 Pro Mockup</title>
    
    <!-- 1. è¼‰å…¥ Tailwind CSS (æ¨£å¼) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        serif: ['"Noto Serif TC"', '"Songti TC"', 'serif'],
                        sans: ['"Noto Serif TC"', '"Songti TC"', 'serif'], 
                    },
                    boxShadow: {
                        'iphone': '0 0 0 1px #4a4a4a, 0 0 0 4px #2a2a2a, 0 20px 50px -10px rgba(0,0,0,0.5)',
                        'inner-screen': 'inset 0 0 20px rgba(0,0,0,0.1)',
                    }
                }
            }
        }
    </script>
    
    <!-- 2. è¼‰å…¥ React å’Œ ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- 3. è¼‰å…¥ Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 4. è¼‰å…¥ Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;500;600;700;900&display=swap');

        /* åœ°åœ–æŒ‰éˆ•çš„è¼•å¾®æµ®å‹•å‹•ç•« */
        @keyframes float {
            0%, 100% { transform: translate(-50%, -50%); }
            50% { transform: translate(-50%, -55%); }
        }
        .animate-float {
            animation: float 3s ease-in-out infinite;
        }
        
        /* é é¢æ·¡å…¥å‹•ç•« */
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fade-in 0.3s ease-out forwards;
        }

        /* å½ˆçª—èƒŒæ™¯ */
        @keyframes backdrop-in {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .animate-backdrop {
            animation: backdrop-in 0.3s ease-out forwards;
        }

        /* æ°´å½©æšˆæŸ“å‹•ç•« (ä¸è¦å‰‡è®Šå½¢èˆ‡æµå‹•) */
        @keyframes blob {
            0% { transform: translate(0px, 0px) scale(1); }
            33% { transform: translate(30px, -50px) scale(1.1); }
            66% { transform: translate(-20px, 20px) scale(0.9); }
            100% { transform: translate(0px, 0px) scale(1); }
        }
        .animate-blob {
            animation: blob 7s infinite;
        }
        .animation-delay-2000 {
            animation-delay: 2s;
        }
        .animation-delay-4000 {
            animation-delay: 4s;
        }

        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        body {
            font-family: "Noto Serif TC", "Songti TC", serif;
            margin: 0;
            padding: 0;
            background-color: #e5e5e5;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .iphone-border {
            box-shadow: 
                inset 0 0 4px 2px rgba(255,255,255,0.3),
                inset 0 0 0 6px #5e5e5e,
                0 0 0 1px #000,
                20px 20px 60px rgba(0,0,0,0.4);
        }
    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- Lucide Icons Helper ---
        const LIcon = ({ name, size = 24, className, ...props }) => {
            const iconData = lucide.icons[name];
            if (!iconData) return null;
            return (
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width={size}
                    height={size}
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    strokeWidth="2"
                    strokeLinecap="round"
                    strokeLinejoin="round"
                    className={className}
                    {...props}
                >
                    {iconData.map((child, index) => {
                        const [tag, attrs] = child;
                        return React.createElement(tag, { ...attrs, key: index });
                    })}
                </svg>
            );
        };

        const icons = {
            Home: (p) => <LIcon name="Home" {...p} />,
            Map: (p) => <LIcon name="Map" {...p} />,
            BookOpen: (p) => <LIcon name="BookOpen" {...p} />,
            Settings: (p) => <LIcon name="Settings" {...p} />,
            Search: (p) => <LIcon name="Search" {...p} />,
            MapPin: (p) => <LIcon name="MapPin" {...p} />,
            Camera: (p) => <LIcon name="Camera" {...p} />,
            Volume2: (p) => <LIcon name="Volume2" {...p} />,
            Type: (p) => <LIcon name="Type" {...p} />,
            User: (p) => <LIcon name="User" {...p} />,
            ChevronRight: (p) => <LIcon name="ChevronRight" {...p} />,
            Star: (p) => <LIcon name="Star" {...p} />,
            Music: (p) => <LIcon name="Music" {...p} />,
            Languages: (p) => <LIcon name="Languages" {...p} />,
            Battery: (p) => <LIcon name="Battery" {...p} />,
            Wifi: (p) => <LIcon name="Wifi" {...p} />,
            Signal: (p) => <LIcon name="Signal" {...p} />,
            X: (p) => <LIcon name="X" {...p} />, 
            Info: (p) => <LIcon name="Info" {...p} />
        };

        // --- Translations ---
        const translations = {
            zh: {
                subtitle: 'å‚³æ‰¿è¨˜æ†¶ï¼Œé€£çµä¸–ä»£',
                searchPlaceholder: 'æœå°‹æ•…äº‹ã€åœ°é»æˆ–æ´»å‹•...',
                recentActivities: 'è¿‘æœŸæ´»å‹•',
                viewAll: 'æŸ¥çœ‹å…¨éƒ¨ >',
                navHome: 'é¦–é ',
                navMap: 'åœ°åœ–',
                navJournal: 'éŠè¨˜',
                navSettings: 'è¨­å®š',
                actMeeting: 'èšæœƒ', actCraft: 'æ‰‹ä½œ', actFood: 'ç¾é£Ÿ', actExplore: 'æ¢ç´¢',
                act1Title: 'æ¦•æ¨¹ä¸‹çš„æ£‹å±€', act1Loc: 'æ‘å£å¤§æ¦•æ¨¹',
                act2Title: 'å¤æ—©å‘³ç«¥ç©è£½ä½œ', act2Loc: 'è€è¡—æ–‡åŒ–é¤¨',
                act3Title: 'é˜¿å¬¤çš„ç§æˆ¿èœæ•™å­¸', act3Loc: 'ç¤¾å€å»šæˆ¿',
                act4Title: 'å°‹æ‰¾éºå¤±çš„ç“¦ç‰‡', act4Loc: 'ä¸‰åˆé™¢éºå€',
                timeToday: 'ä»Šæ—¥ 14:00', timeTomorrow: 'æ˜æ—¥ 10:00', timeSat: 'é€±å…­ 11:00', timeSun: 'é€±æ—¥ 09:00',
                mapTitle: 'æ¢ç´¢åœ°åœ–', mapSubtitle: 'é»æ“Šåœ°é»ä¾†è¨˜éŒ„è¶³è·¡',
                
                locLake: 'åƒå³¶æ¹–',
                locSchool: 'æ°¸å®‰åœ‹å°',
                locWall: 'å½©ç¹ªç‰†',
                locWater: 'åªæ—æ°´è³ªæª¢æ¸¬',
                locTea: 'èŒ¶è¡Œ',
                locSign: 'å¤±è½çš„æ‘èŠæ‹›ç‰Œ',
                locVillage: 'å¤±è½çš„æ‘èŠ',

                descLake: 'å½·å½¿é±·é­šæµ®å‡ºæ°´é¢çš„å£¯é—Šæ™¯è‰²ï¼Œé€™è£¡æ˜¯ç¿¡ç¿ æ°´åº«çš„é›†æ°´å€ï¼Œæ¹–æ°´ç¢§ç¶ æ¸…æ¾ˆï¼Œå€’æ˜ è‘—å±¤å±¤å±±å·’ã€‚',
                descSchool: 'é€™æ˜¯ä¸€æ‰€å……æ»¿æ­·å²çš„æ£®æ—å°å­¸ï¼Œé›–ç„¶å­¸ç”Ÿä¸å¤šï¼Œä½†ä¿ç•™äº†æœ€ç´”æ¨¸çš„æ•™è‚²æ–¹å¼ï¼Œæ ¡åœ’è£¡é‚„æœ‰æ—¥æ²»æ™‚æœŸç•™ä¸‹çš„è€é˜ã€‚',
                descWall: 'åŸæœ¬æ–‘é§çš„è€ç‰†ï¼Œç¶“éç¤¾å€è—è¡“å®¶çš„å·§æ‰‹ï¼Œç•«ä¸Šäº†æ˜”æ—¥è¾²æ‘çš„ç”Ÿæ´»å ´æ™¯ï¼Œæ¯ä¸€å¹…ç•«éƒ½æ˜¯é˜¿å…¬é˜¿å¬¤çš„å›æ†¶ã€‚',
                descWater: 'é€™è£¡å¯ä»¥è§€å¯Ÿæºªæµç”Ÿæ…‹ï¼Œæ¸…æ¾ˆçš„æºªæ°´è£¡æœ‰è‹¦èŠ±é­šåœ¨ç¿»èº«é–ƒçˆï¼Œæ˜¯èªè­˜æ°´æºä¿è­·æœ€å¥½çš„æ•™å®¤ã€‚',
                descTea: 'åªæ—æ˜¯åŒ…ç¨®èŒ¶çš„æ•…é„‰ï¼Œé€™é–“è€èŒ¶è¡Œå‚³æ‰¿äº†äº”ä»£ï¼Œèµ°é€²å»å°±èƒ½èåˆ°æ¿ƒæ¿ƒçš„èŒ¶é¦™ï¼Œè€é—†é‚„æœƒæ•™ä½ æ€éº¼æ³¡å¥½èŒ¶ã€‚',
                descSign: 'ä¸€å¡Šé½è·¡æ–‘æ–‘çš„éµç‰Œï¼Œä¸Šé¢ä¾ç¨€å¯è¦‹ã€ŒXXæ‘ã€çš„å­—æ¨£ï¼Œæ˜¯é€šå¾€é‚£å€‹è¢«æ°´åº«æ·¹æ²’å‰çš„èˆŠèšè½çš„å”¯ä¸€æŒ‡å¼•ã€‚',
                descVillage: 'é€éæ¯æ°´æœŸçš„éºè·¡ï¼Œä¾ç¨€èƒ½çœ‹è¦‹ç•¶å¹´æˆ¿èˆçš„åŸºåº§ã€‚é€™è£¡æ˜¯è¨±å¤šé•·è¼©å…’æ™‚çš„å®¶ï¼Œæ²‰ç¡åœ¨æ°´åº•çš„è¨˜æ†¶ã€‚',
                
                btnCheckIn: 'ğŸ“ è¨˜éŒ„',
                btnClose: 'é—œé–‰',

                journalTitle: 'æˆ‘çš„éŠè¨˜', journalCollected: 'å·²æ”¶é›†', journalCountSuffix: 'ç¯‡',
                noJournal: 'é‚„æ²’æœ‰éŠè¨˜å–”ï¼Œå¿«å»åœ°åœ–æ¢ç´¢å§ï¼', addPhoto: 'é»æ“Šæ–°å¢ç…§ç‰‡',
                initJournalLoc: 'åƒå³¶æ¹–',
                initJournalContent: 'åƒå³¶æ¹–çš„æ™¯è‰²çœŸç¾ï¼Œæ¹–å…‰å±±è‰²å€’æ˜ åœ¨æ°´ä¸­ã€‚é˜¿å…¬èªªä»¥å‰é€™è£¡æ²’æœ‰é€™éº¼å¤šå³¶ï¼Œæ˜¯å› ç‚ºæ°´åº«èˆˆå»ºæ‰è®Šæˆäº†ç¾åœ¨çš„æ¨£å­ã€‚',
                secondJournalLoc: 'æ°¸å®‰åœ‹å°',
                secondJournalContent: 'é€™æ‰€åœ‹å°å……æ»¿äº†å­©å­å€‘çš„ç¬‘è²ã€‚æ ¡åœ’è£¡æœ‰ä¸€æ£µå¤§æ¨¹ï¼Œæ¨¹ä¸‹åŸ‹è‘—è¨±å¤šå±†ç•¢æ¥­ç”Ÿçš„æ™‚å…‰è† å›Šã€‚',
                newJournalContentPrefix: 'çµ‚æ–¼ä¾†åˆ°äº†', newJournalContentSuffix: 'ï¼é€™è£¡çš„ç©ºæ°£èèµ·ä¾†æœ‰ä¸€ç¨®æ‡·èˆŠçš„å‘³é“ã€‚è½èªªé€™è£¡è—è‘—ä¸€å€‹é—œæ–¼é˜¿å…¬å¹´è¼•æ™‚çš„ç§˜å¯†...',
                settingsTitle: 'è¨­å®š', accountName: 'ä¹–å­«çš„å¸³è™Ÿ', accountLevel: 'ç­‰ç´š 5ï¼šå°å°è½çœ¾',
                setFontSize: 'å­—é«”å¤§å°', setValueSize: 'ç‰¹å¤§', setSpeed: 'èªéŸ³æœ—è®€é€Ÿåº¦', setValueSpeed: 'æ…¢',
                setBgMusic: 'èƒŒæ™¯éŸ³æ¨‚', setValueMusic: 'æ‡·èˆŠæ°‘è¬ ', setFavorites: 'æˆ‘çš„æ”¶è—', setLanguage: 'æ•…äº‹èªè¨€', setValueLang: 'å°èª/åœ‹èª',
                logout: 'ç™»å‡ºå¸³è™Ÿ', version: 'ç‰ˆæœ¬ v1.0.2 | é˜¿å…¬è¬›å¤åœ˜éšŠ',
                visitedMsg: 'æ‚¨å·²ç¶“é€ è¨ªé', visitedSuffix: 'å›‰ï¼', arrivedMsg: 'ğŸ‰ å·²æŠµé”', arrivedSuffix: 'ï¼éŠè¨˜å·²ç”Ÿæˆã€‚'
            },
            en: {
                subtitle: 'Inheriting memories, connecting generations.',
                searchPlaceholder: 'Search...',
                recentActivities: 'Recent Activities',
                viewAll: 'View All >',
                navHome: 'Home', navMap: 'Map', navJournal: 'Journal', navSettings: 'Settings',
                actMeeting: 'Gathering', actCraft: 'Craft', actFood: 'Cooking', actExplore: 'Explore',
                act1Title: 'Chess under the Banyan', act1Loc: 'Village Banyan',
                act2Title: 'Toy Making', act2Loc: 'Old Street Hall',
                act3Title: 'Grandma\'s Recipes', act3Loc: 'Community Kitchen',
                act4Title: 'Finding Tiles', act4Loc: 'Ruins',
                timeToday: 'Today 14:00', timeTomorrow: 'Tmrw 10:00', timeSat: 'Sat 11:00', timeSun: 'Sun 09:00',
                mapTitle: 'Explore Map', mapSubtitle: 'Tap to record footprint.',
                locLake: 'Thousand Island Lake',
                locSchool: 'Yong-an Elementary',
                locWall: 'Painted Wall',
                locWater: 'Water Quality Testing',
                locTea: 'Tea Shop',
                locSign: 'Lost Village Sign',
                locVillage: 'The Lost Village',

                descLake: 'A breathtaking view resembling a crocodile surfacing. The emerald water reflects the surrounding mountains beautifully.',
                descSchool: 'A historic forest elementary school preserving rustic education methods and an old bell from the Japanese era.',
                descWall: 'Once a mottled old wall, now painted by local artists with scenes of past rural life, full of memories.',
                descWater: 'An ecological classroom where you can see fish glistening in the clear stream and learn about water conservation.',
                descTea: 'Pinglin is famous for Pouchong tea. This 5th-generation shop smells of rich tea aroma as soon as you walk in.',
                descSign: 'A rusty iron sign pointing the way to the old settlement that existed before the reservoir submerged it.',
                descVillage: 'During dry seasons, foundations of old houses appear. This is the childhood home of many elders, sleeping underwater.',

                btnCheckIn: 'ğŸ“ Check In',
                btnClose: 'Close',

                journalTitle: 'My Journal', journalCollected: 'Collected', journalCountSuffix: '',
                noJournal: 'No entries yet.', addPhoto: 'Add photo',
                initJournalLoc: 'Thousand Island Lake', 
                initJournalContent: 'The scenery at Thousand Island Lake is beautiful. Grandpa said there weren\'t so many islands before the reservoir was built.',
                secondJournalLoc: 'Yong-an Elementary', 
                secondJournalContent: 'This elementary school is full of children\'s laughter. There is a big tree on campus with time capsules from many graduates buried underneath.',

                newJournalContentPrefix: 'Arrived at ', newJournalContentSuffix: '! Smells nostalgic here.',
                settingsTitle: 'Settings', accountName: 'Grandchild', accountLevel: 'Lvl 5: Listener',
                setFontSize: 'Font Size', setValueSize: 'XL', setSpeed: 'Speed', setValueSpeed: 'Slow',
                setBgMusic: 'Music', setValueMusic: 'Folk', setFavorites: 'Favorites', setLanguage: 'Language', setValueLang: 'Tai/Mandarin',
                logout: 'Log Out', version: 'v1.0.2 | Grandpa Team',
                visitedMsg: 'Visited ', visitedSuffix: '!', arrivedMsg: 'ğŸ‰ Arrived at ', arrivedSuffix: '!'
            }
        };

        const ACTIVITIES_DATA = [
            { id: 1, titleKey: 'act1Title', dateKey: 'timeToday', locationKey: 'act1Loc', typeKey: 'actMeeting', icon: 'ğŸµ' },
            { id: 2, titleKey: 'act2Title', dateKey: 'timeTomorrow', locationKey: 'act2Loc', typeKey: 'actCraft', icon: 'ğŸª' },
            { id: 3, titleKey: 'act3Title', dateKey: 'timeSat', locationKey: 'act3Loc', typeKey: 'actFood', icon: 'ğŸ±' },
            { id: 4, titleKey: 'act4Title', dateKey: 'timeSun', locationKey: 'act4Loc', typeKey: 'actExplore', icon: 'ğŸ—ºï¸' },
        ];

        const MAP_POINTS_DATA = [
            { id: 1, x: 20, y: 85, nameKey: 'locLake', descKey: 'descLake', icon: 'ğŸï¸' },
            { id: 2, x: 50, y: 75, nameKey: 'locSchool', descKey: 'descSchool', icon: 'ğŸ«' },
            { id: 3, x: 80, y: 65, nameKey: 'locWall', descKey: 'descWall', icon: 'ğŸ¨' },
            { id: 4, x: 60, y: 50, nameKey: 'locWater', descKey: 'descWater', icon: 'ğŸ’§' },
            { id: 5, x: 30, y: 40, nameKey: 'locTea', descKey: 'descTea', icon: 'ğŸµ' },
            { id: 6, x: 50, y: 25, nameKey: 'locSign', descKey: 'descSign', icon: 'ğŸª§' },
            { id: 7, x: 80, y: 15, nameKey: 'locVillage', descKey: 'descVillage', icon: 'ğŸšï¸' },
        ];

        // --- æ–°å¢ï¼šæ°´å½©æšˆæŸ“èƒŒæ™¯çµ„ä»¶ (Watercolor Background) ---
        const WatercolorBg = () => (
            <div className="absolute inset-0 w-full h-full overflow-hidden pointer-events-none">
                {/* ä½¿ç”¨ mix-blend-multiply å’Œ blur ä¾†æ¨¡æ“¬æ°´å½©æ··è‰²æ•ˆæœ */}
                {/* 1. å·¦ä¸Šï¼šæ¸…æ–°å«©ç¶  */}
                <div className="absolute -top-[10%] -left-[10%] w-[70%] h-[40%] bg-[#dcedc8] rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-blob"></div>
                {/* 2. å³ä¸Šï¼šæº«æš–éµé»ƒ */}
                <div className="absolute top-[5%] -right-[10%] w-[60%] h-[40%] bg-[#fff9c4] rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-blob animation-delay-2000"></div>
                {/* 3. å·¦ä¸‹ï¼šå¤§åœ°æš–è¤ */}
                <div className="absolute -bottom-[10%] -left-[10%] w-[60%] h-[40%] bg-[#ffe0b2] rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-blob animation-delay-4000"></div>
                {/* 4. å³ä¸‹ï¼šæ¸…æ¾ˆæ¹–æ°´ç¶  */}
                <div className="absolute -bottom-[5%] -right-[10%] w-[70%] h-[40%] bg-[#b2dfdb] rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-blob"></div>
            </div>
        );

        // --- å½ˆçª—å…ƒä»¶ ---
        const MapModal = ({ point, onClose, onCheckIn, isVisited, t }) => {
            if (!point) return null;

            return (
                <div className="absolute inset-0 z-50 flex items-center justify-center p-4 bg-black/40 backdrop-blur-sm animate-backdrop">
                    <div className="bg-[#fff9f0] w-full max-w-xs rounded-3xl shadow-2xl overflow-hidden border-4 border-[#8d6e63] transform transition-all animate-fade-in relative">
                        <button onClick={onClose} className="absolute top-3 right-3 text-[#8d6e63] hover:text-[#5d4037] bg-white/50 rounded-full p-1">
                            <icons.X size={24} />
                        </button>

                        <div className="bg-[#eaf8e6] p-6 flex flex-col items-center border-b-2 border-[#d7ccc8]">
                            <div className="text-6xl mb-2 drop-shadow-md">{point.icon}</div>
                            <h3 className="text-2xl font-bold text-[#5d4037]">{t(point.nameKey)}</h3>
                        </div>
                        
                        <div className="p-6">
                            <p className="text-[#5d4037] text-base leading-relaxed mb-6 text-justify">
                                {t(point.descKey)}
                            </p>
                            
                            <button 
                                onClick={() => onCheckIn(point)}
                                className={`w-full py-3 rounded-xl font-bold text-lg shadow-md transition-transform active:scale-95 flex items-center justify-center gap-2
                                ${isVisited 
                                    ? 'bg-[#e0e0e0] text-gray-500 cursor-default' 
                                    : 'bg-[#8d6e63] text-white hover:bg-[#6d4c41]'
                                }`}
                                disabled={isVisited}
                            >
                                {isVisited ? 'âœ… å·²å®Œæˆæ‰“å¡' : t('btnCheckIn')}
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        function GrandpaStoryApp() {
            const [activeTab, setActiveTab] = useState('home');
            const [visitedLocations, setVisitedLocations] = useState([1, 2]); 
            const [showNotification, setShowNotification] = useState(false);
            const [notificationMsg, setNotificationMsg] = useState('');
            const [lang, setLang] = useState('zh');
            const [currentTime, setCurrentTime] = useState('');
            const [selectedPoint, setSelectedPoint] = useState(null);

            useEffect(() => {
                const timer = setInterval(() => {
                    const now = new Date();
                    setCurrentTime(now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', hour12: false }));
                }, 1000);
                return () => clearInterval(timer);
            }, []);

            const t = (key) => translations[lang][key] || key;
            
            const getInitialJournal = () => [
                { id: 1, location: t('initJournalLoc'), time: '2023-10-24', content: t('initJournalContent'), image: 'ğŸï¸' },
                { id: 2, location: t('secondJournalLoc'), time: '2023-10-25', content: t('secondJournalContent'), image: 'ğŸ«' }
            ];
            
            const [journalEntries, setJournalEntries] = useState(getInitialJournal());

            useEffect(() => {
                setJournalEntries(prev => {
                    const initialData = getInitialJournal();
                    const userEntries = prev.filter(entry => entry.id > 2);
                    return [...initialData, ...userEntries];
                });
            }, [lang]);

            const toggleLanguage = () => setLang(prev => prev === 'zh' ? 'en' : 'zh');

            const handlePointClick = (point) => {
                setSelectedPoint(point);
            };

            const handleCheckIn = (pointData) => {
                const locName = t(pointData.nameKey);
                setSelectedPoint(null);
                if (visitedLocations.includes(pointData.id)) return;

                const newEntry = {
                    id: Date.now(),
                    location: locName,
                    time: new Date().toLocaleDateString(),
                    content: `${t('newJournalContentPrefix')}${locName}${t('newJournalContentSuffix')}`,
                    image: pointData.icon
                };
                
                setVisitedLocations([...visitedLocations, pointData.id]);
                setJournalEntries([newEntry, ...journalEntries]);
                setNotificationMsg(`${t('arrivedMsg')}${locName}${t('arrivedSuffix')}`);
                setShowNotification(true);
                setTimeout(() => setShowNotification(false), 3000);
            };

            const renderContent = () => {
                switch (activeTab) {
                    case 'home': return <HomeView t={t} />;
                    case 'map': return <MapView onPointClick={handlePointClick} visited={visitedLocations} t={t} />;
                    case 'journal': return <JournalView entries={journalEntries} t={t} />;
                    case 'settings': return <SettingsView t={t} />;
                    default: return <HomeView t={t} />;
                }
            };

            return (
                <div className="relative">
                    {/* ç‰©ç†æŒ‰éˆ•æ¨¡æ“¬ */}
                    <div className="absolute -left-[4px] top-[180px] w-[3px] h-[30px] bg-gray-400 rounded-l-md"></div>
                    <div className="absolute -left-[4px] top-[230px] w-[3px] h-[50px] bg-gray-400 rounded-l-md"></div>
                    <div className="absolute -left-[4px] top-[290px] w-[3px] h-[50px] bg-gray-400 rounded-l-md"></div>
                    <div className="absolute -right-[4px] top-[250px] w-[3px] h-[80px] bg-gray-400 rounded-r-md"></div>

                    {/* iPhone æœ¬é«” */}
                    <div className="iphone-border bg-black rounded-[55px] p-[12px] w-[393px] h-[852px] relative overflow-hidden">
                        
                        {/* è¢å¹•å€åŸŸ */}
                        <div className="w-full h-full bg-[#eaf8e6] rounded-[44px] overflow-hidden relative shadow-inner-screen flex flex-col">
                            
                            {/* é ‚éƒ¨ç‹€æ…‹åˆ— */}
                            <div className="h-[48px] w-full flex justify-between items-center px-6 pt-2 z-50 text-[#333] font-semibold text-sm absolute top-0 left-0">
                                <div className="w-12 text-center font-sans">{currentTime}</div>
                                <div className="flex gap-2 items-center">
                                    <icons.Signal size={16} fill="currentColor" />
                                    <icons.Wifi size={16} />
                                    <icons.Battery size={20} fill="currentColor" />
                                </div>
                            </div>

                            {/* å‹•æ…‹å³¶ */}
                            <div className="absolute top-[11px] left-1/2 -translate-x-1/2 w-[120px] h-[35px] bg-black rounded-full z-[60] flex justify-center items-center">
                                <div className="w-2 h-2 rounded-full bg-[#1a1a1a] ml-16"></div>
                            </div>

                            {/* ç¿»è­¯æŒ‰éˆ• */}
                            <button onClick={toggleLanguage} className="absolute top-[52px] right-5 z-40 bg-white/80 p-2 rounded-full shadow-md text-[#5d4037] hover:bg-white transition-colors active:scale-95">
                                <icons.Languages size={20} />
                            </button>

                            {/* å½ˆçª—å…ƒä»¶ */}
                            {selectedPoint && (
                                <MapModal 
                                    point={selectedPoint} 
                                    onClose={() => setSelectedPoint(null)} 
                                    onCheckIn={handleCheckIn}
                                    isVisited={visitedLocations.includes(selectedPoint.id)}
                                    t={t}
                                />
                            )}

                            {/* é€šçŸ¥ Toast */}
                            {showNotification && (
                                <div className="absolute top-[60px] left-1/2 transform -translate-x-1/2 z-50 bg-[#5d4037] text-white px-4 py-2 rounded-full shadow-lg text-sm animate-fade-in whitespace-nowrap">
                                    {notificationMsg}
                                </div>
                            )}

                            {/* å…§å®¹æ²å‹•å€ */}
                            <div className="flex-1 overflow-y-auto scrollbar-hide pb-[85px] pt-[48px]">
                                {renderContent()}
                            </div>

                            {/* åº•éƒ¨å°èˆª */}
                            <div className="absolute bottom-0 w-full h-[85px] bg-white/95 backdrop-blur-md border-t border-[#c6e5c3] flex justify-around items-start pt-3 px-2 z-40">
                                <NavButton active={activeTab === 'home'} onClick={() => setActiveTab('home')} icon={<icons.Home size={24} />} label={t('navHome')} />
                                <NavButton active={activeTab === 'map'} onClick={() => setActiveTab('map')} icon={<icons.Map size={24} />} label={t('navMap')} />
                                <NavButton active={activeTab === 'journal'} onClick={() => setActiveTab('journal')} icon={<icons.BookOpen size={24} />} label={t('navJournal')} />
                                <NavButton active={activeTab === 'settings'} onClick={() => setActiveTab('settings')} icon={<icons.Settings size={24} />} label={t('navSettings')} />
                            </div>

                            {/* åº•éƒ¨ Home Indicator */}
                            <div className="absolute bottom-[8px] left-1/2 -translate-x-1/2 w-[130px] h-[5px] bg-black/80 rounded-full z-50 pointer-events-none"></div>

                        </div>
                    </div>
                </div>
            );
        }

        // --- NavButton ---
        const NavButton = ({ active, onClick, icon, label }) => (
            <button onClick={onClick} className={`flex flex-col items-center justify-center w-16 transition-all duration-300 ${active ? 'text-[#6b8e23] -translate-y-1' : 'text-gray-400'}`}>
                <div className={`p-1.5 rounded-2xl ${active ? 'bg-[#eaf8e6] shadow-sm' : ''}`}>
                    {icon}
                </div>
                <span className="text-[10px] mt-0.5 font-medium">{label}</span>
            </button>
        );

        // --- HomeView (åŠ å…¥æ°´å½©èƒŒæ™¯) ---
        const HomeView = ({ t }) => (
            <div className="relative min-h-full px-6 py-4 pb-8">
                {/* æ’å…¥æ°´å½©èƒŒæ™¯ */}
                <WatercolorBg />
                
                {/* å…§å®¹å€å¡Šéœ€è¨­ç‚º relative z-10 ä»¥ç¢ºä¿åœ¨èƒŒæ™¯ä¹‹ä¸Š */}
                <div className="relative z-10">
                    <div className="flex flex-col items-center mb-8 animate-fade-in">
                        <h1 className="text-4xl font-black text-[#3e2723] tracking-[0.15em] drop-shadow-md font-serif my-4 mt-8">
                            é˜¿å…¬è¬›å¤
                        </h1>
                        <p className="text-[#8d6e63] font-medium text-xs mt-1 tracking-widest">{t('subtitle')}</p>
                    </div>

                    <div className="relative mb-8 group">
                        <input type="text" placeholder={t('searchPlaceholder')} className="w-full bg-white/90 h-11 rounded-full pl-10 pr-4 shadow-sm border-2 border-transparent focus:border-[#aed581] focus:outline-none transition-all text-[#5d4037] placeholder-gray-400 text-sm backdrop-blur-sm" />
                        <div className="absolute left-3 top-2.5 text-gray-400 group-focus-within:text-[#aed581] transition-colors"><icons.Search size={18} /></div>
                    </div>

                    <div className="mb-4 flex justify-between items-center">
                        <h2 className="text-lg font-bold text-[#5d4037]">{t('recentActivities')}</h2>
                        <span className="text-xs text-[#6b8e23] font-bold cursor-pointer">{t('viewAll')}</span>
                    </div>

                    <div className="space-y-4 pb-4">
                        {ACTIVITIES_DATA.map((activity) => (
                            <div key={activity.id} className="bg-white/90 p-4 rounded-2xl shadow-sm border-b-4 border-[#c6e5c3] flex items-center gap-4 transform transition-transform active:scale-95 backdrop-blur-sm">
                                <div className="w-14 h-14 bg-[#f1f8e9] rounded-xl flex items-center justify-center text-2xl shadow-inner flex-shrink-0">
                                    {activity.icon}
                                </div>
                                <div className="flex-1 min-w-0">
                                    <h3 className="font-bold text-[#5d4037] text-base truncate">{t(activity.titleKey)}</h3>
                                    <div className="flex items-center text-gray-500 text-xs mt-1 truncate">
                                        <div className="mr-1"><icons.MapPin size={10} /></div>
                                        {t(activity.locationKey)}
                                    </div>
                                    <div className="text-[#6b8e23] text-[10px] font-bold mt-2 bg-[#eaf8e6] inline-block px-2 py-1 rounded-md">
                                        {t(activity.dateKey)} | {t(activity.typeKey)}
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            </div>
        );

        // --- MapView (ä¿æŒç­‰é«˜ç·šèƒŒæ™¯) ---
        const MapView = ({ onPointClick, visited, t }) => {
            return (
                <div className="relative w-full h-full bg-[#eaf8e6] overflow-hidden -mt-[48px] pt-[48px] h-[calc(100%+48px)]">
                    <div className="absolute top-[60px] left-6 z-10">
                        <h2 className="text-2xl font-bold text-[#5d4037]">{t('mapTitle')}</h2>
                        <p className="text-xs text-[#8d6e63]">{t('mapSubtitle')}</p>
                    </div>

                    <div className="absolute inset-0 opacity-30 pointer-events-none">
                        {[...Array(20)].map((_, i) => (
                            <div key={i} className="absolute bg-white rounded-full"
                                style={{
                                    width: Math.random() * 6 + 2 + 'px',
                                    height: Math.random() * 6 + 2 + 'px',
                                    top: Math.random() * 100 + '%',
                                    left: Math.random() * 100 + '%',
                                }}
                            />
                        ))}
                    </div>

                    <div className="absolute w-full left-0 top-[120px] bottom-[100px]">
                        {/* ç­‰é«˜ç·šèƒŒæ™¯ */}
                        <svg className="absolute inset-0 w-full h-full pointer-events-none opacity-40" viewBox="0 0 100 100" preserveAspectRatio="none">
                            <path d="M -20 30 Q 30 20 60 0" fill="none" stroke="#c5e1a5" strokeWidth="0.5" />
                            <path d="M -10 40 Q 30 30 50 0" fill="none" stroke="#c5e1a5" strokeWidth="0.5" />
                            <path d="M 0 50 Q 30 40 40 0" fill="none" stroke="#c5e1a5" strokeWidth="0.5" />
                            <path d="M 40 100 Q 60 70 110 80" fill="none" stroke="#c5e1a5" strokeWidth="0.5" />
                            <path d="M 50 100 Q 70 80 110 90" fill="none" stroke="#c5e1a5" strokeWidth="0.5" />
                            <path d="M 10 70 C 40 60, 60 80, 90 40" fill="none" stroke="#c5e1a5" strokeWidth="0.5" />
                            <path d="M 0 80 C 30 70, 50 90, 100 50" fill="none" stroke="#c5e1a5" strokeWidth="0.5" />
                            <ellipse cx="20" cy="20" rx="10" ry="5" fill="none" stroke="#c5e1a5" strokeWidth="0.5" transform="rotate(-20 20 20)" />
                            <ellipse cx="80" cy="80" rx="15" ry="8" fill="none" stroke="#c5e1a5" strokeWidth="0.5" transform="rotate(10 80 80)" />
                        </svg>

                        <svg className="absolute top-0 left-0 w-full h-full" viewBox="0 0 100 100" preserveAspectRatio="none">
                            <path d="M 20 85 C 50 85, 50 75, 80 65 C 90 60, 80 50, 60 50 C 40 50, 20 45, 30 40 C 40 35, 70 25, 80 15" fill="none" stroke="#aed581" strokeWidth="6" strokeLinecap="round" className="opacity-60" />
                            <path d="M 20 85 C 50 85, 50 75, 80 65 C 90 60, 80 50, 60 50 C 40 50, 20 45, 30 40 C 40 35, 70 25, 80 15" fill="none" stroke="#ffffff" strokeWidth="0.8" strokeDasharray="2 2" className="opacity-50" />
                        </svg>

                        {MAP_POINTS_DATA.map((point) => {
                            const isVisited = visited.includes(point.id);
                            return (
                                <button
                                    key={point.id}
                                    onClick={() => onPointClick(point)}
                                    className={`absolute transform -translate-x-1/2 -translate-y-1/2 flex flex-col items-center transition-all duration-500 hover:scale-105 active:scale-95`}
                                    style={{ left: `${point.x}%`, top: `${point.y}%` }}
                                >
                                    <div className={`
                                        w-12 h-12 rounded-2xl flex items-center justify-center text-2xl shadow-lg border-2 border-white
                                        ${isVisited ? 'bg-[#ffecb3] animate-float' : 'bg-[#8d6e63] text-white grayscale opacity-90'}
                                    `}>
                                        {point.icon}
                                    </div>
                                    <div className={`
                                        -mt-3.5 z-10 px-2 py-0 rounded-md text-xs font-bold whitespace-nowrap shadow-sm
                                        ${isVisited ? 'bg-white text-[#5d4037]' : 'bg-[#5d4037] text-white'}
                                    `}>
                                        {t(point.nameKey)}
                                    </div>
                                </button>
                            );
                        })}
                    </div>
                </div>
            );
        };

        // --- JournalView (åŠ å…¥æ°´å½©èƒŒæ™¯) ---
        const JournalView = ({ entries, t }) => (
            <div className="relative min-h-full px-6 py-4 pb-20 pt-8">
                {/* æ’å…¥æ°´å½©èƒŒæ™¯ */}
                <WatercolorBg />

                <div className="relative z-10">
                    <div className="flex items-center gap-3 mb-6">
                        <h2 className="text-2xl font-bold text-[#5d4037]">{t('journalTitle')}</h2>
                        <div className="bg-[#fff3e0] text-[#ff9800] px-3 py-1 rounded-full text-[10px] font-bold">
                            {t('journalCollected')} {entries.length} {t('journalCountSuffix')}
                        </div>
                    </div>

                    {entries.length === 0 ? (
                        <div className="text-center text-gray-400 mt-20">
                            <p>{t('noJournal')}</p>
                        </div>
                    ) : (
                        <div className="relative border-l-4 border-[#c6e5c3] ml-4 space-y-8">
                            {entries.map((entry) => (
                                <div key={entry.id} className="relative pl-8 group">
                                    <div className="absolute -left-[14px] top-0 w-6 h-6 bg-[#aed581] border-4 border-white rounded-full shadow-sm group-hover:scale-125 transition-transform"></div>
                                    <div className="bg-white/90 rounded-2xl p-5 shadow-sm border-b-4 border-[#e0e0e0] transform transition-all hover:-translate-y-1 hover:shadow-md backdrop-blur-sm">
                                        <div className="flex justify-between items-start mb-3">
                                            <div className="flex items-center gap-2">
                                                <span className="text-2xl">{entry.image}</span>
                                                <h3 className="font-bold text-[#5d4037] text-base">{entry.location}</h3>
                                            </div>
                                            <span className="text-[10px] text-gray-400 bg-gray-100 px-2 py-1 rounded-md">{entry.time}</span>
                                        </div>
                                        <p className="text-[#8d6e63] text-sm leading-relaxed text-justify">{entry.content}</p>
                                        <div className="mt-4 h-28 bg-gray-100/50 rounded-xl flex items-center justify-center text-gray-300 border-2 border-dashed border-gray-200 hover:bg-gray-50 transition-colors cursor-pointer">
                                            <div className="flex items-center"><icons.Camera size={20} className="mr-2" /><span className="text-xs">{t('addPhoto')}</span></div>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            </div>
        );

        // --- SettingsView (åŠ å…¥æ°´å½©èƒŒæ™¯) ---
        const SettingsView = ({ t }) => (
            <div className="relative min-h-full px-6 py-4 pb-20 pt-8">
                {/* æ’å…¥æ°´å½©èƒŒæ™¯ */}
                <WatercolorBg />

                <div className="relative z-10">
                    <h2 className="text-2xl font-bold text-[#5d4037] mb-6">{t('settingsTitle')}</h2>
                    <div className="bg-[#5d4037] rounded-2xl p-6 text-white mb-8 flex items-center gap-4 shadow-lg">
                        <div className="w-14 h-14 bg-white/20 rounded-full flex items-center justify-center backdrop-blur-sm">
                            <icons.User size={28} />
                        </div>
                        <div>
                            <h3 className="font-bold text-lg">{t('accountName')}</h3>
                            <p className="text-white/70 text-xs">{t('accountLevel')}</p>
                        </div>
                    </div>
                    <div className="bg-white/90 rounded-2xl shadow-sm overflow-hidden backdrop-blur-sm">
                        <SettingItem icon={<icons.Type size={18} />} title={t('setFontSize')} value={t('setValueSize')} />
                        <SettingItem icon={<icons.Volume2 size={18} />} title={t('setSpeed')} value={t('setValueSpeed')} />
                        <SettingItem icon={<icons.Music size={18} />} title={t('setBgMusic')} value={t('setValueMusic')} toggle />
                        <SettingItem icon={<icons.Star size={18} />} title={t('setFavorites')} hasArrow />
                        <SettingItem icon={<icons.BookOpen size={18} />} title={t('setLanguage')} value={t('setValueLang')} />
                    </div>
                    <div className="mt-8 text-center">
                        <button className="text-[#5d4037] font-bold text-sm bg-[#eaf8e6] px-6 py-3 rounded-full hover:bg-[#dcedd9] transition-colors shadow-sm">{t('logout')}</button>
                        <p className="text-[10px] text-gray-400 mt-4">{t('version')}</p>
                    </div>
                </div>
            </div>
        );

        const SettingItem = ({ icon, title, value, hasArrow, toggle }) => (
            <div className="flex items-center justify-between p-4 border-b border-gray-100 last:border-0 hover:bg-gray-50/50 transition-colors cursor-pointer">
                <div className="flex items-center gap-3 text-[#5d4037]">
                    <div className="text-[#aed581]">{icon}</div>
                    <span className="font-medium text-sm">{title}</span>
                </div>
                <div className="flex items-center gap-2">
                    {value && <span className="text-xs text-gray-400">{value}</span>}
                    {toggle && <div className="w-9 h-5 bg-[#aed581] rounded-full relative"><div className="absolute right-1 top-1 w-3 h-3 bg-white rounded-full shadow-sm"></div></div>}
                    {hasArrow && <icons.ChevronRight size={16} className="text-gray-300" />}
                </div>
            </div>
        );

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<GrandpaStoryApp />);
    </script>
</body>
</html>